# Copyright (c) Akishi Matsugatani, Seishiro Ono, Yusuke Nomura, Haruki Watanabe

======================================

Preparation

1. Install Quantum Espresso (QE) for DFT calculation of the target material.
   See "https://www.quantum-espresso.org/".
   
   When you compile QE, use the following option.
   
   ./configure --enable-xml=no
   
   This option is necessary to construct the input file of "qeirreps" through "qe2respack".
   It enables qe2respack to use iotk toolkits.

2. Install qe2respack to prepare input files of qeirreps from the output of QE.
   See "https://github.com/mnmpdadish/respackDev/tree/master/util/qe2respack" to get qe2respack.
   qe2respack is available in "respackDev-master/util/qe2respack/".

   See "README.txt" in that directory, edit "Makefile" to specify the location of QE,
   and type "make" to compile qe2respack.

   Our program qeirreps currently uses qe2respack to read the output files of QE.

======================================

How to use qeirreps

1. Prepare the nscf calculation of the target materials by Quantum Espresso(QE).
   Specify high-symmetry k-points where you want to know the irreducible representation.
   (i.e. See example/Bi_nonsoc/Bi.scf.in, Bi.rep.in, and rep_Bi.sh)

   "MATERIAL_NAME.save" (i.e. Bi.save) will be generated by QE.
   This directory stores the information of Bloch wave functions. 
   qe2respack reads this directory in the next step.

   In addition, a norm-conserving calculation are highly recommended to obtain
   proper values of characters, as follows.
   In input files of QE, the valuable should be set "wf_collect = .TRUE.".
   Use pseudo-potentials optimized for norm-conserving calculations.
   (i.e. Optimized Norm-Conserving Vanderbilt Pseudopotential 
   http://www.quantum-simulation.org/potentials/sg15_oncv/)

2. Use qe2respack to obtain the output files of QE as follows.

   Make a directory named "dir-wfn". 
   The output files of qe2respack will be exported in this directory.
   (i.e. example/Bi_nonsoc/dir-wfn)
   
   Move to the directory that contains "dir-wfn" prepared just now. (i.e. example/Bi_nonsoc)
   
   Type "LOCATION_OF_qe2respack/qe2respack LOCATION_OF_QE_OUTPUT/MATERIAL_NAME.save".
   (i.e. "~/respackDev-master/util/qe2respack/ /work/rep/Bi_ns/Bi.save")
   "LOCATION_OF_qe2respack" is the directory which has executable file of qe2respack.
   "LOCATION_OF_QE_OUTPUT/MATERIAL_NAME.save" is the directory produced by QE in step 1.
   
   Some files (i.e. "dat.wfn"), will be created in "dir-wfn".
   qeirreps reads these files in the latter step.


3. Compile qeirreps. Type "make" at the root directory "qeirreps/".
   
   An executable binary "qeirreps.x" will be produced.

4. Run qeirreps.
   
   Make a directory named "output" at the same directory where "dir-wfn" exists.
   (i.e. example/Bi_nonsoc/output)
   The output files of qeirreps will be written here.

   Type "./qeirreps.x DIRECTORY_NAME".
   (i.e. "./qeirreps.x example/Bi_nonsoc")
   where "DIRECTORY_NAME" is the directory that contains "dir-wfn" and "output".

   Some text files will be exported in "DIRECTORY_NAME/output", for example, "character_import.txt".
   They have various data to see irreducible representation.
   Check the next section "Output of qeirreps" for more information.
   Standard output also show some data, for example, the lattice vectors, 
   the reciprocal lattice vectors, type of the symmetry operations, and so on.

   If you want to see the sum of parities for all TRIMs quickly,
   the option is also available as follows.
   Type "./qeirreps.x DIRECTORY_NAME NUMBER_OF_FILLING".
   (i.e. "./qeirreps.x example/Bi_soc 30")
   where "NUMBER_OF_FILLING" is the filling of the target material.

   A filling is defined as the number of electrons per unit cell. This should be an integer number.
   You can find the filling in the log file of QE (i.e. /example/Bi_soc/Bi.rep.out)
   like "number of electrons = 30.00".

======================================

Output of qeirreps

The output files are available in "DIRECTORY_NAME/output".
These files are constructed for Mathematica usage.
See and edit the Mathematica notebook file "example/Bi_nonsoc/Bi.nb" 
or other examples to confirm the information of each file.
(If you need other types of output format, please let us know to improve the program...)

1. rg_import.txt: imported to "pgList".
   The rotation part of symmetry operators.

   pgList[[i]]: The 3 by 3 matrix of the rotation part of the i-th symmetry operator in coordinate space.

2. tg_import.txt: imported to "tgList".
   The translation part of symmetry operators.

   tgList[[i]]: The 3 dimensional vector of the translation part of the i-th symmetry operator.

3. srg_import.txt: imported to "srgList".
   The spin rotation part of symmetry operators.
   You can ignore this when you run calculation without spin-orbit coupling.

   srgList[[i]]: The 2 by 2 matrix of the spin rotation part of the i-th symmetry operator.

4. kg_import.txt: imported to "kOpeList".
   The symmetry operator indices which are elements of G_k on each k-point.
   
   kOpeList[[i,1]]: The 3 dimensional k-vector of the i-th k-point.
   kOpeList[[i,2]]: The symmetry operator index which belongs to G_k of the i-th k-point.

5. character_import.txt: imported to "BandList".
   The characters for G_k of each band.
   (REMARK: These are not characters for G_k/T but for G_k 
	    where T is the lattice translational group.
            Then these characters contain phase factors
            as Exp[-i \vec{k}\cdot\vec{t}_g].)

   BandList[[i,1]]: The 3 dimensional k-vector of the i-th k-point.
   BandList[[i,2,n,j]]: The character of the n-th band for the j-th symmetry operator. 
   		        If the j-th symmetry is not an element of G_k on the i-th k-point,
		        this value becomes "Null".

6. factor_system_nonsymmorphic_import.txt: imported to "factorSystemNS".
   The nonsymmorphic part of the factor system of G_k/T on each k-point.
   This value is defined as follows.

   \omega(g,g') = Exp[i \vec{k}\cdot(\vec{t}_{g'} - p_g\vec{t}_{g'})]

   factorSystemNS[[i,1]]: 
	The 3 dimensional k-vector of the i-th k-point.
   factorSystemNS[[i,2,m,n]]: 
	The nonsymmorphic part of the factor system 
	between the m-th symmetry operator and n-th one.
   	If the m-th or n-th symmetry is not an element of G_k on the i-th k-point,
	this value becomes "Null".
   
7. factor_system_spin_import.txt: imported to "factorSystemSpin".
   The spin part of the factor system of G_k/T on each k-point.

   factorSystemSpin[[i,1]]: 
	The 3 dimensional k-vector of the i-th k-point.
   factorSystemSpin[[i,2,m,n]]:
	The spin part of the factor system
        between the m-th symmetry operator and n-th one.
	If the m-th or n-th symmetry is not an element of G_k on the i-th k-point,
	this value becomes "Null".
						      
======================================

Examples

The four types of examples are available in "example/".
Each example directory stores following files.

*.scf.in, *.band.in, *.bands.in, *rep.in:
Input files for DFT calculation by QE.
Edit the name of directory and pseudo potentials for your situation.
See "https://www.quantum-espresso.org/Doc/INPUT_PW.html"
to confirm how each option works.
scf -> band -> bands: to obtain band structures.
scf -> rep:    	      to obtain irreducible representations.

*.scf.out, *.band.out, *.bands.out, *.rep.out:
The log files of the DFT calculations by QE.

*.band, *.band.rap, *.band.gnu:
The result files of nscf calculation "*.band.in" and "*.bands.in".
You can plot the band structure by gnuplot from "*.band.gnu".

run_*.sh, rep_*.sh:
The job files for the DFT calculation by QE.
Edit some options for your computational situation.
You can calculate the band structure by using "run_*.sh".
("*.scf.in" -> "*.band.in" -> "*.bands.in" will run in this order)
You can calculate the irreducible representations by using "rep_*.sh".
("*.scf.in" -> "*.rep.in" will run in this order)

dir-wfn:
The directory to store the input files for "qeirreps".
"qe2respack" will write the result files of it here.

output:
The directory to store the result files of "qeirreps".
"qeirreps" will write the result files of it here.

exsample_*.nb:
The Mathematica notebook to read the results of "qeirreps".
See "Output of qeirreps" in the previous part for more information.

qeirreps.log:
The log text of standard output when you run "qeirreps.x" for the target material.
This contains following information.

the name of the reading directory
(if you specify the filling) the number of filling 
ncomp: the number of components in the Bloch wave function.
       For calculations Without spin-orbit coupling, ncomp=1.
       For calculations With spin-orbit coupling, ncomp=2.
the lattice/reciprocal lattice vectors
the symmetry operation types for each space group element
the detailed information of symmetry operators
NBAND: the number of bands considered in the calculation 
(if you specify the filling) the summation of parities for time-reversal-invariant-momenta


Brief introduction for each compound is follows.
See "https://materialsproject.org/" and the DFT input files
to confirm the structure data.

Bi:
symmetry group: R-3m (#166) symmorphic
Without spin-orbit coupling, the high symmetry line semi metal.
With spin-orbit coupling, the higher-order topological insulator.
The symmetry-based indicator is calculated from irreps. of inversion symmetry.

Si:
symmetry group: Fd-3m (#227) non-symmorphic
Trivial semiconductor.
The symmetry-based indicator is calculated from irreps. of inversion symmetry.
		      
======================================
